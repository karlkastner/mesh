% Tue 25 Oct 14:20:07 CEST 2016
function [f g g_] = objective_cosa_scaled_side_length(X,Y,cosa0)
	a = Geometry.tri_area(X,Y);
	if (any(a<0))
		f   = NaN;
		g.x = NaN;
		g.y = NaN;
		return;
	end

	f = (cosa0 - ((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3)))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2)).^2.*((X(:,1) - X(:,2)).^2 + (X(:,1) - X(:,3)).^2 + (X(:,2) - X(:,3)).^2 + (Y(:,1) - Y(:,2)).^2 + (Y(:,1) - Y(:,3)).^2 + (Y(:,2) - Y(:,3)).^2);
 
	if (nargout() > 1) 
g.x = [ 2.*(cosa0 - ((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3)))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2)).*((X(:,2) - 2.*X(:,1) + X(:,3))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2) + (((2.*X(:,1) - 2.*X(:,3)).*((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2) + (2.*X(:,1) - 2.*X(:,2)).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).*((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3))))./(2.*(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(3./2))).*((X(:,1) - X(:,2)).^2 + (X(:,1) - X(:,3)).^2 + (X(:,2) - X(:,3)).^2 + (Y(:,1) - Y(:,2)).^2 + (Y(:,1) - Y(:,3)).^2 + (Y(:,2) - Y(:,3)).^2) - (cosa0 - ((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3)))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2)).^2.*(2.*X(:,2) - 4.*X(:,1) + 2.*X(:,3)), ...
                                                      2.*((X(:,1) - X(:,3))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2) - ((2.*X(:,1) - 2.*X(:,2)).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2).*((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3))))./(2.*(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(3./2))).*(cosa0 - ((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3)))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2)).*((X(:,1) - X(:,2)).^2 + (X(:,1) - X(:,3)).^2 + (X(:,2) - X(:,3)).^2 + (Y(:,1) - Y(:,2)).^2 + (Y(:,1) - Y(:,3)).^2 + (Y(:,2) - Y(:,3)).^2) - (cosa0 - ((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3)))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2)).^2.*(2.*X(:,1) - 4.*X(:,2) + 2.*X(:,3)), ...
                                                      2.*((X(:,1) - X(:,2))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2) - ((2.*X(:,1) - 2.*X(:,3)).*((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3))))./(2.*(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(3./2))).*(cosa0 - ((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3)))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2)).*((X(:,1) - X(:,2)).^2 + (X(:,1) - X(:,3)).^2 + (X(:,2) - X(:,3)).^2 + (Y(:,1) - Y(:,2)).^2 + (Y(:,1) - Y(:,3)).^2 + (Y(:,2) - Y(:,3)).^2) - (cosa0 - ((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3)))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2)).^2.*(2.*X(:,1) + 2.*X(:,2) - 4.*X(:,3))];
 
 
g.y = [ 2.*(cosa0 - ((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3)))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2)).*((Y(:,2) - 2.*Y(:,1) + Y(:,3))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2) + (((2.*Y(:,1) - 2.*Y(:,3)).*((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2) + (2.*Y(:,1) - 2.*Y(:,2)).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).*((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3))))./(2.*(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(3./2))).*((X(:,1) - X(:,2)).^2 + (X(:,1) - X(:,3)).^2 + (X(:,2) - X(:,3)).^2 + (Y(:,1) - Y(:,2)).^2 + (Y(:,1) - Y(:,3)).^2 + (Y(:,2) - Y(:,3)).^2) - (cosa0 - ((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3)))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2)).^2.*(2.*Y(:,2) - 4.*Y(:,1) + 2.*Y(:,3)), ...
                                                      2.*((Y(:,1) - Y(:,3))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2) - ((2.*Y(:,1) - 2.*Y(:,2)).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2).*((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3))))./(2.*(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(3./2))).*(cosa0 - ((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3)))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2)).*((X(:,1) - X(:,2)).^2 + (X(:,1) - X(:,3)).^2 + (X(:,2) - X(:,3)).^2 + (Y(:,1) - Y(:,2)).^2 + (Y(:,1) - Y(:,3)).^2 + (Y(:,2) - Y(:,3)).^2) - (cosa0 - ((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3)))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2)).^2.*(2.*Y(:,1) - 4.*Y(:,2) + 2.*Y(:,3)), ...
                                                      2.*((Y(:,1) - Y(:,2))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2) - ((2.*Y(:,1) - 2.*Y(:,3)).*((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3))))./(2.*(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(3./2))).*(cosa0 - ((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3)))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2)).*((X(:,1) - X(:,2)).^2 + (X(:,1) - X(:,3)).^2 + (X(:,2) - X(:,3)).^2 + (Y(:,1) - Y(:,2)).^2 + (Y(:,1) - Y(:,3)).^2 + (Y(:,2) - Y(:,3)).^2) - (cosa0 - ((X(:,1) - X(:,2)).*(X(:,1) - X(:,3)) + (Y(:,1) - Y(:,2)).*(Y(:,1) - Y(:,3)))./(((X(:,1) - X(:,2)).^2 + (Y(:,1) - Y(:,2)).^2).*((X(:,1) - X(:,3)).^2 + (Y(:,1) - Y(:,3)).^2)).^(1./2)).^2.*(2.*Y(:,1) + 2.*Y(:,2) - 4.*Y(:,3))];
	if (nargout() > 2)
		if (issym(X))
			% this is only for scalar coordinates implemented (1 triangle only)
			g_.x = [diff(f,x(1)), diff(f,x(2)),diff(f,x(3))];
			g_.y = [diff(f,y(1)), diff(f,y(2)),diff(f,y(3))];
		else
			g_.x = grad(@(x) objective_angle_scaled_side_length(x,y,cosa0),x);
			g_.y = grad(@(y) objective_angle_scaled_side_length(x,y,cosa0),y);
		end
	end % if nargout > 2
	end % nargout() > 1
end % function

